<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>FTT Big List</title>

  <!-- Performance hints -->
  <meta http-equiv="x-dns-prefetch-control" content="on" />
  <link rel="dns-prefetch" href="https://docs.google.com" />
  <link rel="preconnect" href="https://docs.google.com" crossorigin />
  <link rel="preconnect" href="https://lh3.googleusercontent.com" crossorigin />
  <link rel="preconnect" href="https://www.google.com" crossorigin />

  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="description" content="Community-sourced list of full toilet dommes and experiences." />

  <style>
    :root{
      color-scheme: dark;
      --bg:#05060a;
      --bg-elevated:#0e1017;
      --bg-elevated-soft:#131623;
      --bg-soft:#090b10;
      --border-subtle:#22273a;
      --accent:#9b87ff;
      --accent-soft:#6e56cf;
      --text:#f9fafb;
      --text-soft:#d0d4e2;
      --text-softer:#a0a6c0;
      --danger:#f97373;
      --ok:#4ade80;
      --muted:#6b7280;
      --chip-bg:#111827;
      --chip-border:#1f2933;
      --pill-bg:#111827;
      --pill-border:#374151;
      --shadow-soft:0 18px 45px rgba(15,23,42,0.75);
      --shadow-subtle:0 10px 30px rgba(15,23,42,0.6);
      --grid-line:rgba(148,163,184,0.08);
      --hud-glow:0 0 22px rgba(0,255,179,0.45);
      --hud-green:#4ade80;
      --hud-amber:#fbbf24;
      --hud-red:#fb7185;
      --hud-blue:#38bdf8;
      --toast-bg:rgba(15,23,42,0.98);
      --toast-border:#1f2937;
      --toast-shadow:0 20px 60px rgba(0,0,0,0.75);
      --badge-bg:#111827;
      --badge-border:#4b5563;
      --badge-text:#e5e7eb;
      --tagline:#9ca3af;
      --pill-verified:#22c55e;
      --pill-unverified:#f97316;
      --pill-scam:#ef4444;
      --image-border:#1f2937;
      --image-bg:#020617;
      --image-skeleton:#0f172a;
    }

    *{
      box-sizing:border-box;
    }

    html,body{
      margin:0;
      padding:0;
      font-family:-apple-system,BlinkMacSystemFont,"SF Pro Text",system-ui,-system-ui,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      background:radial-gradient(circle at top, #020617 0, #020617 35%, #000 100%);
      color:var(--text);
      min-height:100%;
      -webkit-font-smoothing:antialiased;
    }

    body{
      display:flex;
      flex-direction:column;
      align-items:center;
      padding:16px;
      gap:16px;
    }

    .page-shell{
      width:100%;
      max-width:1240px;
      display:flex;
      flex-direction:column;
      gap:16px;
    }

    header{
      position:relative;
      padding:16px 16px 14px;
      border-radius:18px;
      background:
        radial-gradient(circle at top left, rgba(56,189,248,0.12), transparent 55%),
        radial-gradient(circle at top right, rgba(94,234,212,0.1), transparent 55%),
        radial-gradient(circle at bottom, rgba(129,140,248,0.12), transparent 60%),
        linear-gradient(135deg, #020617 0, #020617 40%, #020617 100%);
      box-shadow:var(--shadow-soft);
      border:1px solid rgba(148,163,184,0.25);
      overflow:hidden;
    }

    header::before{
      content:"";
      position:absolute;
      inset:-1px;
      background:
        linear-gradient(135deg,
          rgba(248,250,252,0.2) 0,
          transparent 30%,
          transparent 70%,
          rgba(94,234,212,0.14) 100%);
      mix-blend-mode:soft-light;
      opacity:0.7;
      pointer-events:none;
      z-index:-1;
    }

    .header-grid{
      display:grid;
      grid-template-columns:minmax(0,1.35fr) minmax(0,1.1fr);
      gap:16px;
      align-items:stretch;
    }

    @media (max-width:900px){
      .header-grid{
        grid-template-columns:minmax(0,1fr);
      }
    }

    .brand-block{
      display:flex;
      flex-direction:column;
      gap:10px;
    }

    .title-row{
      display:flex;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
    }

    .brand-mark{
      position:relative;
      width:38px;
      height:38px;
      border-radius:14px;
      background:
        conic-gradient(from 220deg,
          #22c55e 0deg,
          #38bdf8 120deg,
          #a855f7 220deg,
          #22c55e 360deg);
      box-shadow:0 0 0 1px rgba(15,23,42,0.9),
                 0 12px 26px rgba(15,23,42,0.95);
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:hidden;
    }

    .brand-inner{
      width:72%;
      height:72%;
      border-radius:10px;
      background:radial-gradient(circle at 20% 0%, #e5e7eb 0, #020617 65%);
      border:1px solid rgba(15,23,42,0.9);
      display:flex;
      align-items:center;
      justify-content:center;
      position:relative;
      overflow:hidden;
      box-shadow:inset 0 0 12px rgba(15,23,42,0.9);
    }

    .brand-inner::before{
      content:"FT";
      font-weight:800;
      font-size:13px;
      letter-spacing:0.08em;
      color:#e5e7eb;
      text-shadow:0 0 9px rgba(15,23,42,0.8);
      transform:translateY(-1px);
    }

    .brand-inner::after{
      content:"";
      position:absolute;
      inset:0;
      background:radial-gradient(circle at 0 0, rgba(248,250,252,0.4), transparent 38%);
      mix-blend-mode:screen;
      opacity:0.9;
    }

    h1{
      font-size:20px;
      margin:0;
      letter-spacing:0.03em;
      text-transform:uppercase;
      color:#e5e7eb;
      text-shadow:0 0 14px rgba(15,23,42,0.95);
      display:flex;
      align-items:center;
      gap:8px;
      flex-wrap:wrap;
    }

    h1 .beta-chip{
      font-size:11px;
      letter-spacing:0.12em;
      text-transform:uppercase;
      padding:2px 7px 3px;
      border-radius:999px;
      border:1px solid rgba(148,163,184,0.65);
      background:radial-gradient(circle at top, rgba(15,23,42,0.85), rgba(15,23,42,0.9));
      color:#e5e7eb;
      box-shadow:0 3px 10px rgba(15,23,42,0.9);
    }

    .tagline{
      margin:0;
      font-size:13px;
      color:var(--tagline);
      max-width:620px;
      line-height:1.4;
    }

    .tagline strong{
      color:#e5e7eb;
      font-weight:600;
    }

    .hero-meta{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      margin-top:6px;
    }

    .pill{
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding:3px 9px 4px;
      border-radius:999px;
      background:rgba(15,23,42,0.9);
      border:1px solid rgba(148,163,184,0.45);
      font-size:11px;
      letter-spacing:0.08em;
      text-transform:uppercase;
      color:var(--text-soft);
      box-shadow:var(--shadow-subtle);
      white-space:nowrap;
    }

    .pill span.emoji{
      font-size:13px;
    }

    .pill strong{
      font-weight:600;
      color:#e5e7eb;
    }

    .controls-row{
      display:flex;
      justify-content:space-between;
      align-items:flex-end;
      gap:12px;
      margin-top:10px;
      flex-wrap:wrap;
    }

    .controls-left{
      display:flex;
      flex-direction:column;
      gap:8px;
      min-width:0;
    }

    .search-row{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      align-items:center;
    }

    .search-box{
      position:relative;
      flex:1 1 220px;
      max-width:380px;
    }

    .search-box input{
      width:100%;
      padding:7px 11px 7px 26px;
      border-radius:999px;
      border:1px solid rgba(148,163,184,0.35);
      background:rgba(15,23,42,0.95);
      color:#e5e7eb;
      font-size:13px;
      outline:none;
      box-shadow:0 6px 18px rgba(15,23,42,0.9);
    }

    .search-box input::placeholder{
      color:#6b7280;
    }

    .search-box span.icon{
      position:absolute;
      left:9px;
      top:50%;
      transform:translateY(-50%);
      font-size:13px;
      color:#6b7280;
    }

    .quick-filters{
      display:flex;
      flex-wrap:wrap;
      gap:6px;
      margin-top:2px;
    }

    .chip{
      border-radius:999px;
      border:1px solid var(--chip-border);
      background:var(--chip-bg);
      padding:3px 9px 4px;
      font-size:11px;
      color:#9ca3af;
      display:inline-flex;
      align-items:center;
      gap:5px;
      cursor:pointer;
      transition:background 0.15s ease,border-color 0.15s ease,transform 0.12s ease;
    }

    .chip .dot{
      width:7px;
      height:7px;
      border-radius:999px;
      background:var(--hud-green);
      box-shadow:0 0 0 1px rgba(34,197,94,0.6),0 0 10px rgba(34,197,94,0.9);
    }

    .chip .dot.orange{
      background:#fb923c;
      box-shadow:0 0 0 1px rgba(251,146,60,0.7),0 0 10px rgba(251,146,60,0.9);
    }

    .chip .dot.red{
      background:#f97373;
      box-shadow:0 0 0 1px rgba(248,113,113,0.7),0 0 10px rgba(248,113,113,0.85);
    }

    .chip.active{
      border-color:var(--accent-soft);
      background:rgba(55,65,81,0.9);
      color:#e5e7eb;
      transform:translateY(-0.5px);
    }

    .chip:hover{
      background:rgba(30,64,175,0.85);
      border-color:#6366f1;
      color:#e5e7eb;
    }

    .status-light{
      display:inline-flex;
      align-items:center;
      gap:4px;
      font-size:11px;
      color:#9ca3af;
    }

    .status-light .led{
      width:8px;
      height:8px;
      border-radius:999px;
      background:#22c55e;
      box-shadow:0 0 0 1px rgba(34,197,94,0.7),0 0 14px rgba(34,197,94,0.95);
    }

    .status-light span.label{
      letter-spacing:0.12em;
      text-transform:uppercase;
    }

    .tabs-and-toggle{
      display:flex;
      flex-direction:column;
      gap:10px;
      align-items:flex-end;
      min-width:260px;
    }

    .button-row{
      display:flex;
      flex-wrap:wrap;
      gap:6px;
      justify-content:flex-end;
    }

    .btn{
      border-radius:999px;
      border:1px solid rgba(148,163,184,0.4);
      background:rgba(15,23,42,0.9);
      color:#e5e7eb;
      padding:4px 10px;
      font-size:11px;
      letter-spacing:0.09em;
      text-transform:uppercase;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      gap:5px;
      box-shadow:var(--shadow-subtle);
      transition:background 0.15s ease,border-color 0.15s ease,transform 0.1s ease,box-shadow 0.12s ease,filter 0.12s ease;
    }

    .btn span.emoji{
      font-size:13px;
    }

    .btn:hover{
      background:rgba(30,64,175,0.95);
      border-color:#6366f1;
      filter:brightness(1.06);
      box-shadow:0 0 0 2px rgba(0,0,0,0.75);
    }

    .btn:active{
      transform:translateY(0.5px);
      box-shadow:0 5px 14px rgba(15,23,42,0.9);
    }

    .btn.us.active      { background:#1d4ed8; border-color:#60a5fa; }
    .btn.canada.active  { background:#991b1b; border-color:#fecaca; }
    .btn.samerica.active{ background:#92400e; border-color:#fed7aa; }
    .btn.europe.active  { background:#581c87; border-color:#c4b5fd; }
    .btn.eastasia.active{ background:#115e59; border-color:#5eead4; }
    .btn.mideast.active { background:#7c2d12; border-color:#fed7aa; }

    .btn.download {
      background:#064e3b;
      border-color:#34d399;
      color:#ecfdf5;
    }

    .btn.download:hover{
      background:#047857;
      border-color:#6ee7b7;
      filter:brightness(1.05);
    }

    .btn.submit{
      background:#7c3aed;
      border-color:#a855f7;
      color:#f9f5ff;
    }

    .btn.submit:hover{
      background:#6d28d9;
      border-color:#c4b5fd;
    }

    .btn.reddit{
      background:#b91c1c;
      border-color:#fecaca;
      color:#fee2e2;
    }

    .btn.reddit:hover{
      background:#dc2626;
      border-color:#fecaca;
    }

    .btn.small{
      font-size:12px;
      padding:.25rem .55rem;
      border-radius:999px;
    }

    .pill-x,
    .pill-social,
    .pill-link,
    .pill-scat,
    .pill-reddit-contact{
      color:#fff;
    }

    .pill-x,
    .pill-social{
      background:#1d9bf0;
    }
    .pill-link{
      background:#1f7a1f;
    }
    .pill-scat{
      background:#8b4513;
    }
    .pill-reddit-contact{
      background:#ff4500;
    }

    .controls {
      display:flex;
      flex-direction:column;
      gap:12px;
    }

    @media (max-width:600px){
      .tabs-and-toggle{
        align-items:flex-start;
        width:100%;
      }
      .button-row{
        justify-content:flex-start;
      }
      .controls-row{
        align-items:flex-start;
      }
    }

    .toggle{
      display:inline-flex;
      align-items:center;
      gap:6px;
      font-size:11px;
      color:#9ca3af;
    }

    .toggle input{
      width:30px;
      height:16px;
      cursor:pointer;
    }

    main{
      background:radial-gradient(circle at top, rgba(15,23,42,0.7), rgba(15,23,42,1));
      border-radius:18px;
      padding:12px 12px 14px;
      border:1px solid rgba(30,64,175,0.5);
      box-shadow:var(--shadow-soft);
      position:relative;
      overflow:hidden;
    }

    main::before{
      content:"";
      position:absolute;
      inset:-1px;
      background:
        linear-gradient(120deg,
          transparent 0,
          rgba(56,189,248,0.12) 32%,
          transparent 68%,
          rgba(129,140,248,0.18) 100%);
      mix-blend-mode:soft-light;
      opacity:0.9;
      pointer-events:none;
      z-index:-1;
    }

    .hud-grid-overlay{
      position:absolute;
      inset:0;
      background-image:
        linear-gradient(to right, var(--grid-line) 1px, transparent 1px),
        linear-gradient(to bottom, var(--grid-line) 1px, transparent 1px);
      background-size:40px 40px;
      opacity:0.26;
      pointer-events:none;
      mix-blend-mode:soft-light;
      z-index:-2;
    }

    .starfield{
      position:absolute;
      inset:0;
      background-image:
        radial-gradient(1px 1px at 10% 15%, rgba(148,163,184,0.55), transparent),
        radial-gradient(1px 1px at 25% 65%, rgba(148,163,184,0.45), transparent),
        radial-gradient(1px 1px at 75% 35%, rgba(148,163,184,0.5), transparent),
        radial-gradient(1px 1px at 60% 80%, rgba(148,163,184,0.35), transparent);
      opacity:0.4;
      mix-blend-mode:screen;
      pointer-events:none;
      z-index:-3;
    }

    .table-shell{
      position:relative;
      border-radius:12px;
      border:1px solid rgba(15,23,42,0.95);
      overflow:hidden;
      background:radial-gradient(circle at top, #020617 0, #020617 40%, #020617 100%);
      box-shadow:0 18px 50px rgba(15,23,42,0.95);
    }

    table{
      width:100%;
      border-collapse:collapse;
      font-size:13px;
      color:#e5e7eb;
      table-layout:fixed;
    }

    thead{
      background:radial-gradient(circle at top, #020617 0, #020617 40%, #020617 100%);
      position:relative;
      z-index:1;
    }

    thead tr{
      border-bottom:1px solid rgba(31,41,55,0.95);
    }

    th,td{
      padding:8px 10px;
      text-align:left;
      border-bottom:1px solid rgba(17,24,39,0.95);
      vertical-align:top;
    }

    th{
      font-size:11px;
      text-transform:uppercase;
      letter-spacing:0.16em;
      color:#9ca3af;
      background:linear-gradient(to bottom, rgba(15,23,42,0.98), rgba(15,23,42,0.98));
      position:sticky;
      top:0;
      z-index:10;
    }

    tbody tr:nth-child(even){
      background:rgba(15,23,42,0.96);
    }

    tbody tr:nth-child(odd){
      background:rgba(15,23,42,0.98);
    }

    tbody tr:hover{
      background:rgba(30,64,175,0.13);
    }

    th.name-col{
      width:180px;
    }

    th.region-col{
      width:140px;
    }

    th.links-col{
      width:210px;
    }

    th.price-col{
      width:140px;
    }

    th:last-child,
    td:last-child{
      width:50px;
      text-align:center;
    }

    .name-cell{
      display:flex;
      flex-direction:column;
      gap:4px;
    }

    .name-main{
      display:flex;
      align-items:center;
      gap:6px;
      flex-wrap:wrap;
    }

    .name-main strong{
      font-size:14px;
      color:#f9fafb;
    }

    .badge{
      font-size:10px;
      letter-spacing:0.16em;
      text-transform:uppercase;
      padding:2px 7px 2px;
      border-radius:999px;
      border:1px solid var(--badge-border);
      background:var(--badge-bg);
      color:var(--badge-text);
    }

    .badge.scam{
      border-color:#ef4444;
      color:#fecaca;
      background:rgba(127,29,29,0.95);
    }

    .badge.good{
      border-color:#22c55e;
      color:#bbf7d0;
      background:rgba(22,101,52,0.95);
    }

    .location-line{
      font-size:11px;
      color:#9ca3af;
      display:flex;
      align-items:center;
      gap:6px;
      flex-wrap:wrap;
    }

    .location-line span.tag{
      font-size:10px;
      padding:2px 5px;
      border-radius:999px;
      border:1px solid rgba(55,65,81,0.9);
      background:rgba(15,23,42,0.95);
      color:#9ca3af;
    }

    .stack-block{
      display:flex;
      flex-direction:column;
      gap:4px;
      font-size:12px;
    }

    .stack-line{
      display:flex;
      gap:4px;
      align-items:flex-start;
      flex-wrap:wrap;
    }

    .stack-label{
      text-transform:uppercase;
      letter-spacing:0.16em;
      font-size:10px;
      color:#9ca3af;
      min-width:88px;
    }

    .stack-value{
      color:#e5e7eb;
      display:flex;
      flex-wrap:wrap;
      gap:4px;
      align-items:center;
    }

    .cell-link{
      color:#93c5fd;
      text-decoration:none;
      border-bottom:1px dashed rgba(147,197,253,0.4);
      padding-bottom:1px;
    }

    .cell-link:hover{
      color:#bfdbfe;
      border-bottom-style:solid;
    }

    .sentiment{
      font-size:16px;
      margin-right:2px;
    }

    .price-pill{
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding:3px 9px 4px;
      border-radius:999px;
      border:1px solid rgba(55,65,81,0.9);
      background:rgba(15,23,42,0.98);
      font-size:12px;
      box-shadow:0 8px 18px rgba(15,23,42,0.9);
    }

    .price-pill span.range{
      font-weight:600;
      color:#e5e7eb;
    }

    .price-pill span.meta{
      font-size:11px;
      color:#9ca3af;
    }

    .scam-flag{
      display:inline-flex;
      align-items:center;
      gap:4px;
      font-size:11px;
      color:#fecaca;
      background:rgba(127,29,29,0.95);
      border-radius:999px;
      padding:2px 8px;
      border:1px solid rgba(248,113,113,0.75);
      box-shadow:0 10px 24px rgba(127,29,29,0.9);
    }

    .scam-flag span.icon{
      font-size:13px;
    }

    .rating-dot{
      width:8px;
      height:8px;
      border-radius:999px;
      background:#22c55e;
      box-shadow:0 0 0 1px rgba(34,197,94,0.7),0 0 10px rgba(34,197,94,0.95);
    }

    .rating-dot.medium{
      background:#fbbf24;
      box-shadow:0 0 0 1px rgba(251,191,36,0.7),0 0 10px rgba(251,191,36,0.95);
    }

    .rating-dot.high{
      background:#f97316;
      box-shadow:0 0 0 1px rgba(249,115,22,0.75),0 0 10px rgba(249,115,22,0.95);
    }

    .rating-dot.extreme{
      background:#ef4444;
      box-shadow:0 0 0 1px rgba(239,68,68,0.8),0 0 12px rgba(239,68,68,0.98);
    }

    .images-cell{
      text-align:center;
      font-size:11px;
      color:#9ca3af;
    }

    .thumb-wrapper{
      width:72px;
      height:72px;
      border-radius:12px;
      border:1px solid var(--image-border);
      overflow:hidden;
      margin:0 auto;
      background:var(--image-bg);
      display:flex;
      align-items:center;
      justify-content:center;
      box-shadow:0 14px 36px rgba(15,23,42,0.9);
    }

    .thumb-wrapper img{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
    }

    .thumb-skeleton{
      width:100%;
      height:100%;
      background:
        radial-gradient(circle at 0 0, rgba(148,163,184,0.16), transparent 55%),
        linear-gradient(120deg, var(--image-skeleton), #020617 45%, var(--image-skeleton) 100%);
      animation:pulse 1.6s ease-in-out infinite;
    }

    @keyframes pulse{
      0%{ opacity:0.7; }
      50%{ opacity:1; }
      100%{ opacity:0.7; }
    }

    .footer-actions{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin-top:10px;
      flex-wrap:wrap;
      font-size:12px;
      color:#9ca3af;
    }

    .footer-actions .linkish{
      text-decoration:underline;
      text-decoration-style:dotted;
      cursor:pointer;
    }

    .footer-consent{
      margin-top:4px;
      font-size:11px;
      color:#6b7280;
      max-width:900px;
    }

    .footer-consent a{
      color:#93c5fd;
    }

    .toast{
      position:fixed;
      bottom:16px;
      right:16px;
      background:var(--toast-bg);
      border-radius:14px;
      padding:9px 12px;
      border:1px solid var(--toast-border);
      box-shadow:var(--toast-shadow);
      display:flex;
      align-items:flex-start;
      gap:8px;
      font-size:12px;
      color:#e5e7eb;
      max-width:260px;
      z-index:999;
    }

    .toast .icon{
      font-size:16px;
    }

    .toast .body strong{
      display:block;
      margin-bottom:2px;
    }

    .toast .body span{
      color:#9ca3af;
      font-size:11px;
    }

    .toast .close{
      margin-left:6px;
      cursor:pointer;
      font-size:14px;
      color:#9ca3af;
    }

    .toast-hidden{
      display:none;
    }

    .scam-icon-inline{
      display:inline-flex;
      align-items:center;
      gap:3px;
      margin-left:4px;
      font-size:11px;
      color:#fecaca;
      background:rgba(127,29,29,0.98);
      border-radius:999px;
      padding:1px 6px;
      border:1px solid rgba(248,113,113,0.75);
    }

    .scam-icon-inline span.icon{
      font-size:12px;
    }

    .hud-stats{
      margin-top:6px;
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      font-size:11px;
      color:#9ca3af;
    }

    .hud-stats span{
      display:inline-flex;
      align-items:center;
      gap:5px;
    }

    .hud-stats span strong{
      color:#e5e7eb;
    }

    .hud-stats span.bad{
      color:#fecaca;
    }

    .hud-stats span.bad strong{
      color:#fecaca;
    }

    .hud-stats span.good{
      color:#bbf7d0;
    }

    .hud-stats span.good strong{
      color:#bbf7d0;
    }

    .hud-scanline{
      position:absolute;
      left:0;
      right:0;
      top:0;
      height:1px;
      background:linear-gradient(90deg, transparent 0, rgba(56,189,248,0.6) 50%, transparent 100%);
      opacity:0.55;
      mix-blend-mode:screen;
      pointer-events:none;
      transform:translateY(-50%);
      animation:scanline 7.5s linear infinite;
    }

    @keyframes scanline{
      0%{ transform:translateY(-50%); opacity:0; }
      10%{ opacity:0.8; }
      50%{ transform:translateY(calc(100% + 50%)); opacity:0.25; }
      90%{ opacity:0.8; }
      100%{ transform:translateY(-50%); opacity:0; }
    }

    .hud-annotations{
      position:absolute;
      right:14px;
      top:14px;
      font-size:10px;
      text-transform:uppercase;
      letter-spacing:0.14em;
      color:#9ca3af;
      text-align:right;
    }

    .hud-annotations span{
      display:block;
    }

    .hud-annotations .primary{
      color:#e5e7eb;
    }

    .table-scroll{
      max-height:610px;
      overflow:auto;
      position:relative;
      scroll-behavior:smooth;
      scrollbar-width:thin;
      scrollbar-color:rgba(148,163,184,0.8) rgba(15,23,42,1);
    }

    .table-scroll::-webkit-scrollbar{
      width:8px;
      height:8px;
    }

    .table-scroll::-webkit-scrollbar-track{
      background:#020617;
    }

    .table-scroll::-webkit-scrollbar-thumb{
      background:linear-gradient(to bottom, #4b5563, #9ca3af);
      border-radius:999px;
    }

    .table-scroll::-webkit-scrollbar-thumb:hover{
      background:linear-gradient(to bottom, #6b7280, #e5e7eb);
    }

    @media (max-width:768px){
      th.name-col{ width:150px; }
      th.region-col{ width:120px; }
      th.links-col{ width:200px; }
      .page-shell{
        padding-bottom:10px;
      }
      .table-scroll{
        max-height:540px;
      }
    }

    @media (max-width:600px){
      body{
        padding:12px 8px;
      }
      header{
        padding:12px 12px 10px;
      }
      main{
        padding:10px 8px 10px;
      }
      .table-shell{
        border-radius:10px;
      }
      th,td{
        padding:7px 8px;
      }
      .stack-label{
        min-width:74px;
      }
    }

    .image-hidden .thumb-wrapper{
      display:none;
    }

    .image-hidden .images-cell{
      font-size:10px;
      color:#6b7280;
    }

    .image-hidden .images-cell::before{
      content:"üîí Disabled";
      display:block;
      margin-bottom:2px;
    }

    .spinner{
      border-radius:999px;
      width:16px;
      height:16px;
      border:2px solid rgba(148,163,184,0.3);
      border-top-color:rgba(129,140,248,0.95);
      animation:spin 0.8s linear infinite;
    }

    @keyframes spin{
      to{ transform:rotate(360deg); }
    }

    .loading-mask{
      position:absolute;
      inset:0;
      background:radial-gradient(circle at top, rgba(15,23,42,0.96), rgba(2,6,23,0.96));
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      gap:8px;
      font-size:12px;
      color:#9ca3af;
      z-index:50;
    }

    .loading-mask strong{
      color:#e5e7eb;
    }

    .loading-mask span.sub{
      font-size:11px;
      color:#6b7280;
    }

    .hud-tagline{
      font-size:11px;
      text-transform:uppercase;
      letter-spacing:0.13em;
      color:#9ca3af;
      margin-top:6px;
    }

    .hud-tagline span{
      color:#e5e7eb;
    }

    .images-opt-out{
      display:inline-flex;
      align-items:center;
      gap:4px;
      font-size:10px;
      letter-spacing:0.12em;
      text-transform:uppercase;
      color:#9ca3af;
      margin-top:3px;
    }

    .images-opt-out span.badge{
      border-radius:999px;
      border:1px solid rgba(156,163,175,0.9);
      padding:1px 6px;
      font-size:9px;
      letter-spacing:0.12em;
      color:#e5e7eb;
      background:rgba(15,23,42,0.98);
    }

    .viz-section{
      margin-top:6px;
      font-size:11px;
      color:#9ca3af;
      display:flex;
      flex-direction:column;
      gap:4px;
    }

    .viz-line{
      display:flex;
      flex-wrap:wrap;
      gap:6px;
      align-items:center;
    }

    .viz-line span.label{
      text-transform:uppercase;
      letter-spacing:0.13em;
      font-size:10px;
      color:#9ca3af;
    }

    .viz-bar{
      flex:1;
      height:5px;
      border-radius:999px;
      background:linear-gradient(90deg, #22c55e, #eab308, #f97316, #ef4444);
      box-shadow:0 0 12px rgba(52,211,153,0.6);
      position:relative;
      overflow:hidden;
    }

    .viz-bar::after{
      content:"";
      position:absolute;
      inset:0;
      background:linear-gradient(120deg, transparent 0, rgba(248,250,252,0.22) 45%, transparent 100%);
      mix-blend-mode:screen;
      opacity:0.5;
    }

    .viz-note{
      font-size:10px;
      color:#6b7280;
    }

    .hud-feed{
      margin-top:8px;
      font-size:11px;
      color:#9ca3af;
    }

    .hud-feed span.label{
      text-transform:uppercase;
      letter-spacing:0.13em;
      font-size:10px;
      color:#9ca3af;
    }

    .hud-feed span.value{
      color:#e5e7eb;
      margin-left:4px;
    }

    .hud-feed span.value code{
      font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size:10px;
      background:#020617;
      padding:2px 4px;
      border-radius:4px;
      border:1px solid #1f2937;
    }
  </style>
</head>
<body>
  <div class="page-shell">
    <header>
      <div class="hud-scanline"></div>
      <div class="header-grid">
        <div class="brand-block">
          <div class="title-row">
            <div class="brand-mark">
              <div class="brand-inner"></div>
            </div>
            <h1>
              Full Toilet Mistress Community List
              <span class="beta-chip">Community Beta</span>
            </h1>
          </div>
          <p class="tagline">
            A community-curated, continually updated list of
            <strong>full toilet mistresses</strong>, their
            <strong>offerings, reviews, and risk signals</strong>.
            <br />
            <strong>Built by the Full Toilet community. Use at your own risk.</strong>
          </p>

          <div class="hero-meta">
            <div class="pill">
              <span class="emoji">üõ∞Ô∏è</span>
              <span><strong>Live feed</strong> from Google Sheets</span>
            </div>
            <div class="pill">
              <span class="emoji">üß†</span>
              <span><strong>Threat assessment</strong> overlays scam reports &amp; experience</span>
            </div>
            <div class="pill">
              <span class="emoji">üõü</span>
              <span><strong>Community-sourced</strong> ‚Äî please verify before sending money</span>
            </div>
          </div>

          <div class="hud-stats">
            <span class="good">
              <span class="rating-dot"></span>
              <strong id="statTotal">--</strong> profiles loaded
            </span>
            <span>
              <span class="rating-dot medium"></span>
              <strong id="statCountries">--</strong> regions covered
            </span>
            <span class="bad">
              <span class="rating-dot extreme"></span>
              <strong id="statScams">--</strong> flagged scam / danger reports
            </span>
          </div>

          <div class="hud-tagline">
            THREAT MONITOR: <span id="hudThreatText">Satellite uplink‚Ä¶ awaiting community signals.</span>
          </div>
        </div>

        <div class="tabs-and-toggle">
          <div class="controls">
            <div class="controls-row">
              <div class="controls-left">
                <div class="search-row">
                  <div class="search-box">
                    <span class="icon">üîç</span>
                    <input
                      type="text"
                      id="searchInput"
                      placeholder="Search by name, country, city, or notes‚Ä¶"
                    />
                  </div>
                  <div class="status-light">
                    <span class="led"></span>
                    <span class="label">LIVE SYNC</span>
                  </div>
                </div>
                <div class="quick-filters">
                  <div class="chip" data-filter="hasReviews">
                    <span class="dot"></span>
                    Reviewed
                  </div>
                  <div class="chip" data-filter="needsReview">
                    <span class="dot orange"></span>
                    Needs reviews
                  </div>
                  <div class="chip" data-filter="scamRisk">
                    <span class="dot red"></span>
                    Scam / risk reports
                  </div>
                </div>
              </div>
              <div class="tabs-and-toggle">
                <div class="button-row" role="navigation" aria-label="Region Tabs">
                  <button class="btn us active" data-gid="0">
                    <span class="emoji">üá∫üá∏</span>
                    United States
                  </button>
                  <button class="btn canada" data-gid="918890863">
                    <span class="emoji">üá®üá¶</span>
                    Canada
                  </button>
                  <button class="btn samerica" data-gid="506975496">
                    <span class="emoji">üåé</span>
                    South America + Caribbean
                  </button>
                  <button class="btn europe" data-gid="1560092023">
                    <span class="emoji">üá™üá∫</span>
                    Europe + Nordic
                  </button>
                  <button class="btn eastasia" data-gid="1966795654">
                    <span class="emoji">üåè</span>
                    East Asia + Oceania + Australia
                  </button>
                  <button class="btn mideast" data-gid="1604960979">
                    <span class="emoji">üåç</span>
                    Middle East
                  </button>
                </div>
                <label class="toggle">
                  <input type="checkbox" id="imageToggle" checked />
                  <span>Show profile images (where available)</span>
                </label>
              </div>
            </div>
          </div>

          <div class="hud-annotations">
            <span class="primary">SCANNING SUBJECT ATTRIBUTES‚Ä¶</span>
            <span>Cross-referencing: experience, scam reports, price bands</span>
          </div>
        </div>
      </div>
    </header>

    <main>
      <div class="hud-grid-overlay"></div>
      <div class="starfield"></div>

      <div class="table-shell">
        <div class="loading-mask" id="loadingMask">
          <div class="spinner"></div>
          <strong>Initializing satellite feed‚Ä¶</strong>
          <span class="sub">Fetching community list from Google Sheets and synthesizing threat overlays.</span>
        </div>

        <div class="table-scroll" id="tableScroll">
          <table id="dataTable">
            <thead>
              <tr>
                <th class="name-col" data-sort="Name">Name</th>
                <th class="region-col" data-sort="Region">Region / City</th>
                <th data-sort="Experience">Experience?</th>
                <th data-sort="Verified">Verified?</th>
                <th class="links-col">Links</th>
                <th data-sort="Price">Price / Notes</th>
                <th>Img</th>
              </tr>
            </thead>
            <tbody id="tableBody">
              <!-- Rows injected -->
            </tbody>
          </table>
        </div>
      </div>

      <div class="viz-section">
        <div class="viz-line">
          <span class="label">Signal strength</span>
          <div class="viz-bar" aria-hidden="true"></div>
        </div>
        <div class="viz-note">
          Profiles with <strong>more reviews</strong> and <strong>clearer signals</strong> appear more trustworthy ‚Äî
          but nothing here is guaranteed. Always verify independently.
        </div>
      </div>

      <div class="hud-feed">
        <span class="label">Console</span>
        <span class="value"><code id="hudConsole">booting threat assessment HUD‚Ä¶</code></span>
      </div>

      <div class="images-opt-out">
        <span class="badge">NEW</span>
        <span>Toggle images off if you prefer a text-only view.</span>
      </div>

      <div class="footer-actions">
        <span class="linkish" id="resetSort">Reset sorting</span>
        <button id="downloadCsvBtn" class="btn download">‚¨áÔ∏è Download CSV</button>

        <a
          class="btn submit"
          href="https://docs.google.com/forms/d/e/1FAIpQLSfbY17FJMkIvTPIjQZjXYT1MXEdWGb4bFCiB3A_Pq2Smpoq2Q/viewform?usp=header"
          target="_blank"
          rel="noopener"
        >
          Submit to list
        </a>
        <a
          class="btn reddit"
          href="https://www.reddit.com/r/FullToiletMistresses/"
          target="_blank"
          rel="noopener"
        >
          Reddit
        </a>

        <div class="button-row bottom-tabs" role="navigation" aria-label="Tabs (bottom)">
          <button class="btn us active" data-gid="0">United States</button>
          <button class="btn canada" data-gid="918890863">Canada</button>
          <button class="btn samerica" data-gid="506975496">South America + Caribbean</button>
          <button class="btn europe" data-gid="1560092023">Europe + Nordic</button>
          <button class="btn eastasia" data-gid="1966795654">East Asia + Oceania + Australia</button>
          <button class="btn mideast" data-gid="1604960979">Middle East</button>
        </div>
      </div>

      <div class="footer-consent">
        Consent is important. If you are on the list and want to be removed, please
        <a href="https://docs.google.com/forms/d/e/1FAIpQLSfbY17FJMkIvTPIjQZjXYT1MXEdWGb4bFCiB3A_Pq2Smpoq2Q/viewform?usp=header" target="_blank" rel="noopener">
          use the community form
        </a>.
        This interface only visualizes data from the Google Sheet; it does not store anything itself.
      </div>
    </main>
  </div>

  <div id="toast" class="toast toast-hidden" role="status" aria-live="polite">
    <div class="icon">‚ö†Ô∏è</div>
    <div class="body">
      <strong>Danger / Scam reports detected</strong>
      <span>Profiles tagged with üö´ have strong scam or danger reports from the community. Proceed with extreme caution.</span>
    </div>
    <div class="close" id="toastClose" aria-label="Dismiss">√ó</div>
  </div>

  <script>
  const SHEET_BASE =
    "https://docs.google.com/spreadsheets/d/1_lP35halmPRREXCuJDsWn498saq_RieMPx6RFk_WeM0/gviz/tq?tqx=out:json";
  const GID_US = "0";
  const GID_CA = "918890863";
  const GID_SAM = "506975496";
  const GID_EU = "1560092023";
  const GID_EAST = "1966795654";
  const GID_ME = "1604960979";

  const COL_LETTERS = {
    NAME: "A",
    COUNTRY: "B",
    CITY: "C",
    REGION_TEXT: "D",
    WEBSITE: "E",
    LINKS_HUB: "F",
    SOCIAL: "G",
    VERIFIED: "H",
    EXPERIENCE: "I",
    PRICE: "J",
    SCAM: "K",
    NOTES: "L",
    MANUAL_FLAG: "M",
    IMAGE_URL: "N",
    FULL_REVIEW: "O",
    REDDIT: "P",
    EMAIL: "R",
    WHATSAPP: "S",
    PHONE: "Q",
    FETLIFE: "T",
    SCAT: "U"
  };

  function colLetterToIdx(letter){ let n=0; for(let i=0;i<letter.length;i++) n=n*26+(letter.charCodeAt(i)-64); return n-1; }

  let COL_IDX = {};
  for (const [key, letter] of Object.entries(COL_LETTERS)) {
    COL_IDX[key] = colLetterToIdx(letter);
  }

  const NAME_COL_IDX = COL_IDX.NAME;
  const COUNTRY_COL_IDX = COL_IDX.COUNTRY;
  const CITY_COL_IDX = COL_IDX.CITY;
  const REGION_TEXT_COL_IDX = COL_IDX.REGION_TEXT;
  const E_COL_IDX = COL_IDX.WEBSITE;
  const F_COL_IDX = COL_IDX.LINKS_HUB;
  const G_COL_IDX = COL_IDX.SOCIAL;
  const H_COL_IDX = COL_IDX.VERIFIED;
  const I_COL_IDX = COL_IDX.EXPERIENCE;
  const J_COL_IDX = COL_IDX.PRICE;
  const K_COL_IDX = COL_IDX.SCAM;
  const L_COL_IDX = COL_IDX.NOTES;
  const M_COL_IDX = COL_IDX.MANUAL_FLAG;
  const N_COL_IDX = COL_IDX.IMAGE_URL;
  const FULL_REVIEW_COL_IDX = COL_IDX.FULL_REVIEW;
  const P_COL_IDX = COL_IDX.REDDIT;
  const EMAIL_COL_IDX = COL_IDX.EMAIL;
  const WHATSAPP_COL_IDX = COL_IDX.WHATSAPP;
  const Q_COL_IDX = COL_IDX.PHONE;
  const FETLIFE_COL_IDX = COL_IDX.FETLIFE;
  const SCAT_COL_IDX = COL_IDX.SCAT;

  const URL_RE = /(https?:\/\/[^\s]+)/i;

  function $(sel, root=document){ return root.querySelector(sel); }
  function $$(sel, root=document){ return Array.from(root.querySelectorAll(sel)); }

  function prettyUrlText(url){
    try {
      const u = new URL(url);
      const host = u.hostname.replace(/^www\./i,"");
      const path = u.pathname.replace(/\/+/g,"/").replace(/\/$/,"");
      return path ? `${host}${path}` : host;
    } catch(_e){
      return url;
    }
  }

  function firstUrl(str){
    const m = str && str.match(URL_RE);
    return m ? m[1] : null;
  }

  function parseRedditUsername(raw){
    if (!raw) return null;
    const s = String(raw).trim();
    if (/^https?:\/\//i.test(s)) {
      try{
        const u = new URL(s);
        const parts = u.pathname.split("/").filter(Boolean);
        const idx = parts.indexOf("user") >=0 ? parts.indexOf("user") : parts.indexOf("u");
        if (idx>=0 && parts[idx+1]) return parts[idx+1];
      }catch(_e){}
    }
    const m = s.match(/u\/([A-Za-z0-9_-]+)/);
    if (m) return m[1];
    if (/^[A-Za-z0-9_-]+$/.test(s)) return s;
    return null;
  }

  function buildRedditLink(val){
    const user = parseRedditUsername(val);
    if (!user) return null;
    const a = document.createElement("a");
    a.href = `https://www.reddit.com/user/${encodeURIComponent(user)}`;
    a.target = "_blank";
    a.rel = "noopener";
    a.textContent = `u/${user}`;
    a.className = "cell-link";
    return a;
  }

  function buildMailtoLink(email){
    if (!/@/.test(email)) return null;
    const a = document.createElement("a");
    a.href = `mailto:${email.trim()}`;
    a.textContent = email.trim();
    a.className = "cell-link";
    return a;
  }

  function detectSocialKind(text){
    const s = (text || "").toLowerCase();
    if (s.includes("twitter.com") || s.includes("x.com") || s.includes("twitter/x") || s.includes(" @") || s.startsWith("@")) {
      return "x";
    }
    if (s.includes("bsky.app") || s.includes("bsky.social") || s.includes("bluesky")) {
      return "bluesky";
    }
    return null;
  }

  function buildTelAnchor(raw){
    const digits = (raw||"").replace(/[^\d+]/g,"");
    if (!digits) return null;
    let hrefDigits = digits;
    if (digits.startsWith("+")) hrefDigits = digits;
    else if (digits.length === 10) hrefDigits = "+1" + digits;
    else hrefDigits = "+" + digits;
    const a = document.createElement("a");
    a.href = `tel:${hrefDigits}`;
    a.target = "_self";
    a.textContent = raw.trim();
    a.className = "cell-link";
    return a;
  }

  function buildWhatsappAnchor(raw){
    const digits = (raw||"").replace(/[^\d+]/g,"");
    if (!digits) return null;
    let phone = digits;
    if (!phone.startsWith("+")) {
      if (phone.length === 10) phone = "+1" + phone;
      else phone = "+" + phone;
    }
    const a = document.createElement("a");
    a.href = `https://wa.me/${phone.replace(/[^\d]/g,"")}`;
    a.target = "_blank";
    a.rel = "noopener";
    a.textContent = raw.trim();
    a.className = "cell-link";
    return a;
  }

  function linkifyWithMore(text, {alwaysShow=false, pretty=false}={}){
    if (!text) return null;
    const str = String(text);
    const frag = document.createDocumentFragment();
    const matches = [...str.matchAll(URL_RE)];
    if (!matches.length) {
      if (!alwaysShow) return null;
      frag.textContent = str;
      return frag;
    }
    let lastIndex = 0;
    matches.forEach((m, idx)=>{
      const url = m[1];
      const start = m.index;
      if (start>lastIndex){
        frag.append(str.slice(lastIndex, start));
      }
      const a = document.createElement("a");
      a.href = url;
      a.target = "_blank";
      a.rel = "noopener";
      a.textContent = pretty ? prettyUrlText(url) : url;
      a.className = "cell-link";
      frag.append(a);
      lastIndex = start + url.length;
      if (idx===0 && matches.length>1 && !alwaysShow){
        frag.append(" (+ more)");
        lastIndex = str.length;
      }
    });
    if (lastIndex<str.length){
      frag.append(str.slice(lastIndex));
    }
    return frag;
  }

  function buildImageThumbCell(url){
    const wrapper = document.createElement("div");
    wrapper.className = "thumb-wrapper";

    if (!url){
      const sk = document.createElement("div");
      sk.className = "thumb-skeleton";
      wrapper.appendChild(sk);
      return wrapper;
    }

    const img = document.createElement("img");
    img.loading = "lazy";
    img.alt = "Profile image";
    img.src = url;
    img.addEventListener("error", ()=>{
      wrapper.innerHTML = "";
      const sk = document.createElement("div");
      sk.className = "thumb-skeleton";
      wrapper.appendChild(sk);
    });
    wrapper.appendChild(img);
    return wrapper;
  }

  function computePriceNumber(raw){
    if (!raw) return NaN;
    const s = String(raw).toLowerCase();
    const m = s.match(/(\d+(?:\.\d+)?)/);
    return m ? parseFloat(m[1]) : NaN;
  }

  function computeThreatScore(row){
    let score = 0;
    const scam = (row[K_COL_IDX] || "").toString().toLowerCase();
    const exp = (row[I_COL_IDX] || "").toString().toLowerCase();
    const ver = (row[H_COL_IDX] || "").toString().toLowerCase();
    const manual = (row[M_COL_IDX] || "").toString().toLowerCase();

    if (scam.includes("scam") || scam.includes("danger") || scam.includes("avoid")) score += 70;
    if (manual.includes("scam") || manual.includes("danger")) score += 40;
    if (ver.includes("unverified") || ver.includes("none")) score += 15;
    if (exp.includes("no experience") || exp.includes("none")) score += 10;
    if (exp.includes("mixed")) score += 15;
    if (exp.includes("negative")) score += 25;

    if (ver.includes("verified") || ver.includes("trusted")) score -= 30;
    if (exp.includes("many positive") || exp.includes("positive")) score -= 25;

    if (score < 0) score = 0;
    if (score > 100) score = 100;
    return score;
  }

  let tableData = [];
  let currentGid = GID_US;
  let currentSort = { key: null, dir: 1 };
  let lazyObserver = null;
  let pollingInterval = null;
  let lastFetchSignature = "";

  const tableBody = document.getElementById("tableBody");
  const tableScroll = document.getElementById("tableScroll");
  const loadingMask = document.getElementById("loadingMask");
  const hudConsoleEl = document.getElementById("hudConsole");
  const hudThreatTextEl = document.getElementById("hudThreatText");
  const imageToggle = document.getElementById("imageToggle");
  const toastEl = document.getElementById("toast");
  const toastClose = document.getElementById("toastClose");
  const resetSortBtn = document.getElementById("resetSort");
  const downloadCsvBtn = document.getElementById("downloadCsvBtn");
  const searchInput = document.getElementById("searchInput");
  const statTotalEl = document.getElementById("statTotal");
  const statCountriesEl = document.getElementById("statCountries");
  const statScamsEl = document.getElementById("statScams");

  function showToast(){
    toastEl.classList.remove("toast-hidden");
  }

  function hideToast(){
    toastEl.classList.add("toast-hidden");
  }

  toastClose.addEventListener("click", hideToast);
  toastEl.addEventListener("click", (e)=>{
    if (e.target === toastEl) hideToast();
  });

  function setHudConsole(msg){
    hudConsoleEl.textContent = msg;
  }

  function setHudThreatText(msg){
    hudThreatTextEl.textContent = msg;
  }

  function updateStats(data){
    statTotalEl.textContent = data.length.toString();
    const regions = new Set();
    let scams = 0;
    data.forEach(row=>{
      const c = (row[COUNTRY_COL_IDX] || "").toString().trim();
      if (c) regions.add(c);
      const scam = (row[K_COL_IDX] || "").toString().toLowerCase();
      if (scam.includes("scam") || scam.includes("danger")) scams++;
    });
    statCountriesEl.textContent = regions.size.toString();
    statScamsEl.textContent = scams.toString();
  }

  function buildPricePill(txt){
    if (!txt || !String(txt).trim()) return null;
    const n = computePriceNumber(txt);
    const pill = document.createElement("div");
    pill.className = "price-pill";

    const dot = document.createElement("span");
    dot.className = "rating-dot";
    if (n > 400) dot.classList.add("extreme");
    else if (n > 250) dot.classList.add("high");
    else if (n > 150) dot.classList.add("medium");
    pill.appendChild(dot);

    const range = document.createElement("span");
    range.className = "range";
    range.textContent = txt;
    pill.appendChild(range);

    const meta = document.createElement("span");
    meta.className = "meta";
    if (Number.isFinite(n)) {
      if (n <= 150) meta.textContent = "Community-friendly";
      else if (n <= 250) meta.textContent = "Mid-range";
      else if (n <= 400) meta.textContent = "High-end";
      else meta.textContent = "Extreme pricing";
    } else {
      meta.textContent = "Varies / ask directly";
    }
    pill.appendChild(meta);

    return pill;
  }

  function appendScamIcon(node, text){
    if (!text) return;
    const s = String(text).toLowerCase();
    if (!(s.includes("scam") || s.includes("danger") || s.includes("avoid"))) return;
    showToast();
    const span = document.createElement("span");
    span.className = "scam-icon-inline";
    const icon = document.createElement("span");
    icon.className = "icon";
    icon.textContent = "üö´";
    span.appendChild(icon);
    const label = document.createElement("span");
    label.textContent = "SCAM / DANGER REPORTS";
    span.appendChild(label);
    node.appendChild(span);
  }

  function renderTable(){
    tableBody.innerHTML = "";

    const query = (searchInput.value || "").toLowerCase().trim();
    let rows = tableData;

    if (query){
      rows = rows.filter(row=>{
        const name = (row[NAME_COL_IDX] || "").toString().toLowerCase();
        const ctry = (row[COUNTRY_COL_IDX] || "").toString().toLowerCase();
        const city = (row[CITY_COL_IDX] || "").toString().toLowerCase();
        const notes = (row[L_COL_IDX] || "").toString().toLowerCase();
        const links = (row[E_COL_IDX] || "") + " " + (row[F_COL_IDX] || "") + " " + (row[G_COL_IDX] || "");
        const linksLc = links.toString().toLowerCase();
        return name.includes(query) || ctry.includes(query) || city.includes(query) || notes.includes(query) || linksLc.includes(query);
      });
    }

    if (currentSort.key){
      const key = currentSort.key;
      const dir = currentSort.dir;
      rows = [...rows].sort((a,b)=>{
        let va="", vb="";
        if (key === "Name") {
          va = (a[NAME_COL_IDX] || "").toString().toLowerCase();
          vb = (b[NAME_COL_IDX] || "").toString().toLowerCase();
        } else if (key === "Region") {
          va = ((a[COUNTRY_COL_IDX] || "") + " " + (a[CITY_COL_IDX] || "")).toString().toLowerCase();
          vb = ((b[COUNTRY_COL_IDX] || "") + " " + (b[CITY_COL_IDX] || "")).toString().toLowerCase();
        } else if (key === "Experience") {
          va = (a[I_COL_IDX] || "").toString().toLowerCase();
          vb = (b[I_COL_IDX] || "").toString().toLowerCase();
        } else if (key === "Verified") {
          va = (a[H_COL_IDX] || "").toString().toLowerCase();
          vb = (b[H_COL_IDX] || "").toString().toLowerCase();
        } else if (key === "Price") {
          va = computePriceNumber(a[J_COL_IDX] || "");
          vb = computePriceNumber(b[J_COL_IDX] || "");
          if (!Number.isFinite(va)) va = 999999;
          if (!Number.isFinite(vb)) vb = 999999;
        }
        if (va<vb) return -1*dir;
        if (va>vb) return 1*dir;
        return 0;
      });
    }

    rows.forEach((row, rowIndex)=>{
      const tr = document.createElement("tr");

      const nameCell = document.createElement("td");
      nameCell.className = "name-cell";
      const nameBlock = document.createElement("div");
      nameBlock.className = "name-main";
      const nameStrong = document.createElement("strong");
      nameStrong.textContent = row[NAME_COL_IDX] || "Unknown";
      nameBlock.appendChild(nameStrong);

      const scamTxt = (row[K_COL_IDX] || "").toString().toLowerCase();
      const manualTxt = (row[M_COL_IDX] || "").toString().toLowerCase();
      const hasScam = scamTxt.includes("scam") || scamTxt.includes("danger") || scamTxt.includes("avoid") || manualTxt.includes("scam") || manualTxt.includes("danger");
      const hasGood = scamTxt.includes("legit") || scamTxt.includes("good") || manualTxt.includes("trusted");

      if (hasScam){
        const badge = document.createElement("span");
        badge.className = "badge scam";
        badge.textContent = "DANGER / SCAM REPORTS";
        nameBlock.appendChild(badge);
      } else if (hasGood){
        const badge = document.createElement("span");
        badge.className = "badge good";
        badge.textContent = "GOOD EXPERIENCES REPORTED";
        nameBlock.appendChild(badge);
      }

      nameCell.appendChild(nameBlock);

      const locLine = document.createElement("div");
      locLine.className = "location-line";
      const country = (row[COUNTRY_COL_IDX] || "").toString().trim();
      const city = (row[CITY_COL_IDX] || "").toString().trim();
      const regionTxt = (row[REGION_TEXT_COL_IDX] || "").toString().trim();

      if (country || city || regionTxt){
        const locBits = [];
        if (city) locBits.push(city);
        if (country) locBits.push(country);
        if (regionTxt && regionTxt.toLowerCase() !== (country.toLowerCase() || "")) locBits.push(regionTxt);
        locLine.textContent = locBits.join(" ‚Ä¢ ");
      } else {
        locLine.textContent = "Region unknown";
      }

      if (!country){
        const tag = document.createElement("span");
        tag.className = "tag";
        tag.textContent = "Needs location";
        locLine.appendChild(tag);
      }

      nameCell.appendChild(locLine);
      tr.appendChild(nameCell);

      const regionCell = document.createElement("td");
      const regionBlock = document.createElement("div");
      regionBlock.className = "stack-block";
      const line = document.createElement("div");
      line.textContent = country || "‚Äî";
      regionBlock.appendChild(line);
      if (city){
        const line2 = document.createElement("div");
        line2.textContent = city;
        regionBlock.appendChild(line2);
      }
      if (regionTxt){
        const line3 = document.createElement("div");
        line3.textContent = regionTxt;
        regionBlock.appendChild(line3);
      }
      regionCell.appendChild(regionBlock);
      tr.appendChild(regionCell);

      for (let c = 2; c <= 8; c++){
        if (c === 2 || c === 3) continue;

        const td = document.createElement("td");
        const txt = row[c] || "";

        if (c === H_COL_IDX && rowIndex > 1) {
          const verRaw = row[H_COL_IDX] || "";
          const ren = ""; 
          const block = document.createElement("div");
          block.className = "stack-block";

          if (verRaw.trim()) {
            const vLower = verRaw.toLowerCase();
            let emojis = "";
            if (vLower.includes("needs review") || vLower.includes("needs verification")) emojis += "‚ö†Ô∏è";
            if (vLower.includes("scam")) emojis += "üö´";
            if (vLower.includes("trusted") || vLower.includes("verified")) emojis += "‚úÖ";

            if (emojis) {
              const line = document.createElement("div");
              const eSpan = document.createElement("span");
              eSpan.textContent = emojis;
              line.appendChild(eSpan);
              block.appendChild(line);
            }
          }

          if (verRaw.trim()) {
            const line = document.createElement("div");
            line.textContent = verRaw;
            appendScamIcon(line, verRaw);
            block.appendChild(line);
          } else {
            const line = document.createElement("div");
            line.textContent = "Not verified / needs confirmation";
            block.appendChild(line);
          }

          if (ren && ren.trim()) {
            const line = document.createElement("div");
            line.textContent = "Renown: " + ren;
            block.appendChild(line);
          }

          td.appendChild(block);
          tr.appendChild(td);
          continue;
        }

        /* Experience? + Full Review button stacked */
        if (c === I_COL_IDX && rIdx > 1) {
          let exp = row[I_COL_IDX] || "";
          const linkReview = FULL_REVIEW_COL_IDX >= 0 ? (row[FULL_REVIEW_COL_IDX] || "") : "";
          const block = document.createElement("div");
          block.className = "stack-block";

          if (!exp.trim()) {
            exp = "Needs review";
          }

          const tExp = exp.toString().trim().toLowerCase();
          let iconSpan = null;
          if (tExp === "positive") {
            iconSpan = document.createElement("span");
            iconSpan.className = "sentiment";
            iconSpan.textContent = "üëç";
            iconSpan.title = "Positive";
          } else if (tExp === "negative") {
            iconSpan = document.createElement("span");
            iconSpan.className = "sentiment";
            iconSpan.textContent = "üëé";
            iconSpan.title = "Negative";
          } else if (tExp === "neutral") {
            iconSpan = document.createElement("span");
            iconSpan.className = "sentiment";
            iconSpan.textContent = "ü§∑";
            iconSpan.title = "Neutral";
          }

          if (tExp.includes("needs review")) {
            const line = document.createElement("div");
            line.className = "stack-line";
            const lbl = document.createElement("span");
            lbl.className = "stack-label";
            lbl.textContent = "Experience:";
            const v = document.createElement("span");
            v.className = "stack-value";
            const textSpan = document.createElement("span");
            textSpan.textContent = "Needs review ‚ùì";
            appendScamIcon(textSpan, exp);
            v.appendChild(textSpan);
            line.appendChild(lbl);
            line.appendChild(v);
            block.appendChild(line);
          } else if (iconSpan) {
            const line = document.createElement("div");
            line.className = "stack-line";
            const lbl = document.createElement("span");
            lbl.className = "stack-label";
            lbl.textContent = "Experience:";
            const v = document.createElement("span");
            v.className = "stack-value";
            v.appendChild(iconSpan);
            const textSpan = document.createElement("span");
            textSpan.textContent = " " + exp;
            appendScamIcon(textSpan, exp);
            v.appendChild(textSpan);
            line.appendChild(lbl);
            line.appendChild(v);
            block.appendChild(line);
          } else if (exp.trim()) {
            const line = document.createElement("div");
            line.textContent = exp;
            appendScamIcon(line, exp);
            block.appendChild(line);
          }

          if (linkReview && URL_RE.test(linkReview)) {
            const m = linkReview.match(URL_RE);
            const url = m ? m[1] : null;
            if (url) {
              const line = document.createElement("div");
              line.className = "stack-line";
              const v = document.createElement("span");
              v.className = "stack-value";
              const btn = document.createElement("a");
              btn.href = url;
              btn.target = "_blank";
              btn.rel = "noopener";
              btn.textContent = "Full Review";
              btn.className = "btn small";
              v.appendChild(btn);
              line.appendChild(v);
              block.appendChild(line);
            }
          }

          td.appendChild(block);
          tr.appendChild(td);
          continue;
        }

        /* Price + badge */
        if (c === J_COL_IDX && rIdx > 1) {
          const txtPrice = txt;
          const n = computePriceNumber(txtPrice);
          const cleaned = Number.isFinite(n) ? n : null;
          const block = document.createElement("div");
          block.className = "stack-block";

          const pill = buildPricePill(txtPrice);
          if (pill) block.appendChild(pill);
          else if (txtPrice && String(txtPrice).trim()){
            const line = document.createElement("div");
            line.textContent = txtPrice;
            block.appendChild(line);
          } else {
            const line = document.createElement("div");
            line.textContent = "Ask for pricing";
            block.appendChild(line);
          }

          td.appendChild(block);
          tr.appendChild(td);
          continue;
        }

        if (c === K_COL_IDX && rIdx > 1) {
          const scamTxt = row[K_COL_IDX] || "";
          const block = document.createElement("div");
          block.className = "stack-block";
          if (scamTxt && String(scamTxt).trim()) {
            const line = document.createElement("div");
            line.textContent = scamTxt;
            appendScamIcon(line, scamTxt);
            block.appendChild(line);
          } else {
            const line = document.createElement("div");
            line.textContent = "No explicit scam reports in sheet (yet).";
            block.appendChild(line);
          }
          td.appendChild(block);
          tr.appendChild(td);
          continue;
        }

        /* Combined Links block */
        if (c === E_COL_IDX && rIdx > 1) {
          const website = row[E_COL_IDX] || "";
          const links = F_COL_IDX >= 0 ? (row[F_COL5_IDX] || "") : "";
          const links = F_COL_IDX >= 0 ? (row[F_COL_IDX] || "") : "";
          const social = G_COL_IDX >= 0 ? (row[G_COL_IDX] || "") : "";
          const scat = SCAT_COL_IDX >= 0 ? (row[SCAT_COL_IDX] || "") : "";
          const fet = FETLIFE_COL_IDX >= 0 ? (row[FETLIFE_COL_IDX] || "") : "";
          const block = document.createElement("div");
          block.className = "stack-block";

          function addLine(label, value){
            if (!value || !String(value).trim()) return;
            const line = document.createElement("div");
            line.className = "stack-line";
            const l = document.createElement("span");
            l.className = "stack-label";
            l.textContent = label;
            const v = document.createElement("span");
            v.className = "stack-value";
            const frag = linkifyWithMore(value, {alwaysShow:false, pretty:true});
            if (frag) v.appendChild(frag); else v.textContent = value;
            line.appendChild(l);
            line.appendChild(v);
            block.appendChild(line);
          }

          function firstUrlOrEmpty(text) {
            const m = text && text.match(URL_RE);
            return m ? m[1] : "";
          }

          function usernameFromUrl(url) {
            try {
              const u = new URL(url);
              const parts = (u.pathname || "").split("/").filter(Boolean);
              return parts[parts.length - 1] || "";
            } catch {
              return "";
            }
          }

          function stripComToDash(host) {
            return host.replace(/\.com$/i, " - ");
          }

          function buildSocialPill(raw) {
            if (!raw || !raw.trim()) return null;
            const kind = detectSocialKind(raw);
            const url = firstUrlOrEmpty(raw);
            let handle = "";
            let href = url || "";

            if (kind === "x") {
              if (url) {
                handle = usernameFromUrl(url);
              }
              if (!handle && /^@/.test(raw.trim())) {
                handle = raw.trim().replace(/^@+/, "").split(/\s+/)[0];
              }
              if (!href && handle) {
                href = "https://x.com/" + handle;
              }
              if (!handle) return null;
              const a = document.createElement("a");
              a.href = href || "#";
              a.target = "_blank";
              a.rel = "noopener";
              a.textContent = "X: " + handle;
              a.className = "btn small pill-x";
              return a;
            }

            // Bluesky or generic social with @handle
            if (/@/.test(raw)) {
              const match = raw.match(/@[A-Za-z0-9_.-]+/);
              if (match) {
                handle = match[0];
              }
            }
            if (!handle) {
              const u2 = url;
              if (u2) {
                const name = usernameFromUrl(u2);
                if (name) handle = "@" + name;
              }
            }
            if (!handle) return null;

            const a = document.createElement("a");
            a.href = href || "#";
            a.target = "_blank";
            a.rel = "noopener";
            a.textContent = "Social: " + handle;
            a.className = "btn small pill-social";
            return a;
          }

          function buildLinkHubPill(raw) {
            if (!raw || !raw.trim()) return null;
            const url = firstUrlOrEmpty(raw);
            if (!url) return null;
            try {
              const u = new URL(url);
              const host = (u.hostname || "").replace(/^www\./i, "");
              const parts = (u.pathname || "").split("/").filter(Boolean);
              const user = parts[0] || "";
              let label;

              if (/^linktr\.ee$/i.test(host)) {
                label = "Link Tree: " + (user || host);
              } else if (/^allmylinks\.com$/i.test(host)) {
                label = "All my links: " + (user || host);
              } else if (/^beacons\.ai$/i.test(host)) {
                label = "Links: Beacons- " + (user || host);
              } else {
                let base = stripComToDash(host);
                if (user) {
                  label = base + " " + user;
                } else {
                  label = base;
                }
              }

              const a = document.createElement("a");
              a.href = url;
              a.target = "_blank";
              a.rel = "noopener";
              a.textContent = label;
              a.className = "btn small pill-link";
              return a;
            } catch {
              return null;
            }
          }

          function buildScatPill(raw) {
            if (!raw || !raw.trim()) return null;
            const url = firstUrlOrEmpty(raw);
            if (!url) return null;
            try {
              const u = new URL(url);
              const hostRaw = (u.hostname || "").replace(/^www\./i, "");
              const host = hostRaw.toLowerCase();
              const parts = (u.pathname || "").split("/").filter(Boolean);
              const user = parts[0] || "";
              let label;

              if (host.includes("scatbook")) {
                label = "Scatbook: " + (user || "profile");
              } else if (host.includes("darkfans")) {
                label = "Darkfans: " + (user || "profile");
              } else {
                let base = stripComToDash(hostRaw);
                const pretty = prettyUrlText(url).replace(/\.com\b/i, " - ");
                label = "Scat link: " + pretty;
              }

              const a = document.createElement("a");
              a.href = url;
              a.target = "_blank";
              a.rel = "noopener";
              a.textContent = label;
              a.className = "btn small pill-scat";

              return a;
            } catch {
              return null;
            }
          }

          if (website.trim()) addLine("Website:", website);

          if (links.trim()) {
            const line = document.createElement("div");
            line.className = "stack-line";
            const v = document.createElement("span");
            v.className = "stack-value";
            const pill = buildLinkHubPill(links);
            if (pill) {
              v.appendChild(pill);
            } else {
              const frag = linkifyWithMore(links, {alwaysShow:false, pretty:true});
              if (frag) v.appendChild(frag); else v.textContent = links;
            }
            line.appendChild(v);
            block.appendChild(line);
          }

          if (social.trim()) {
            const line = document.createElement("div");
            line.className = "stack-line";
            const v = document.createElement("span");
            v.className = "stack-value";
            const pill = buildSocialPill(social);
            if (pill) {
              v.appendChild(pill);
            } else {
              const frag = linkifyWithMore(social, {alwaysShow:false, pretty:true});
              if (frag) v.appendChild(frag); else v.textContent = social;
            }
            line.appendChild(v);
            block.appendChild(line);
          }

          if (scat.trim()) {
            const line = document.createElement("div");
            line.className = "stack-line";
            const v = document.createElement("span");
            v.className = "stack-value";
            const pill = buildScatPill(scat);
            if (pill) {
              v.appendChild(pill);
            } else {
              const frag = linkifyWithMore(scat, {alwaysShow:false, pretty:true});
              if (frag) v.appendChild(frag); else v.textContent = scat;
            }
            line.appendChild(v);
            block.appendChild(line);
          }

          if (fet.trim()) addLine("Fetlife:", fet);

          td.appendChild(block);
          tr.appendChild(td);
          continue;
        }
/* Combined Contact info */
        if (c === EMAIL_COL_IDX && rIdx > 1) {
          const emailRaw = row[EMAIL_COL_IDX] || "";
          const redditRaw = P_COL_IDX >= 0 ? (row[P_COL_IDX] || "") : "";
          const phoneRaw = Q_COL_IDX >= 0 ? (row[Q_COL_IDX] || "") : "";
          const whatsappRaw = WHATSAPP_COL_IDX >= 0 ? (row[WHATSAPP_COL_IDX] || "") : "";
          const block = document.createElement("div");
          block.className = "stack-block";

          function addMulti(labelBase, raw, builder){
            if (!raw) return;
            const parts = String(raw).split(/[;,]/);
            let idxInner = 0;
            for (const part of parts) {
              const val = part.trim();
              if (!val) continue;
              const node = builder(val);
              if (!node) continue;
              const lineInner = document.createElement("div");
              lineInner.className = "stack-line";
              const lInner = document.createElement("span");
              lInner.className = "stack-label";
              lInner.textContent = idxInner === 0 ? labelBase + ":" : labelBase + " alt:";
              const vInner = document.createElement("span");
              vInner.className = "stack-value";
              vInner.appendChild(node);
              lineInner.appendChild(lInner);
              lineInner.appendChild(vInner);
              block.appendChild(lineInner);
              idxInner++;
            }
          }

          addMulti("Phone", phoneRaw, (val)=>buildTelAnchor(val));
          addMulti("WhatsApp", whatsappRaw, (val)=>buildWhatsappAnchor(val));
          addMulti("Email", emailRaw, (val)=>{
            if (!/@/.test(val)) return null;
            const a = document.createElement("a");
            a.href = `mailto:${val.trim()}`;
            a.textContent = val.trim();
            a.className = "cell-link";
            return a;
          });

          if (redditRaw && String(redditRaw).trim()) {
            const parts = String(redditRaw).split(/[;,]/);
            for (const part of parts) {
              const val = part.trim();
              if (!val) continue;
              const user = parseRedditUsername(val);
              if (!user) continue;
              const lineR = document.createElement("div");
              lineR.className = "stack-line";
              const vR = document.createElement("span");
              vR.className = "stack-value";
              const aR = document.createElement("a");
              aR.href = `https://www.reddit.com/user/${encodeURIComponent(user)}`;
              aR.target = "_blank";
              aR.rel = "noopener";
              aR.textContent = `Reddit: u/${user}`;
              aR.className = "btn small pill-reddit-contact";
              vR.appendChild(aR);
              lineR.appendChild(vR);
              block.appendChild(lineR);
            }
          }

          td.appendChild(block);
          tr.appendChild(td);
          continue;
        }

        if (c === L_COL_IDX && rIdx > 1) {
          const note = row[L_COL_IDX] || "";
          const block = document.createElement("div");
          block.className = "stack-block";
          if (note && String(note).trim()) {
            const lineNote = document.createElement("div");
            lineNote.textContent = note;
            appendScamIcon(lineNote, note);
            block.appendChild(lineNote);
          } else {
            const lineNote = document.createElement("div");
            lineNote.textContent = "No extra notes in sheet yet.";
            block.appendChild(lineNote);
          }
          td.appendChild(block);
          tr.appendChild(td);
          continue;
        }

        if (c === N_COL_IDX && rIdx > 1) {
          const imageUrl = row[N_COL_IDX] || "";
          const cellDiv = document.createElement("div");
          cellDiv.className = "images-cell";
          cellDiv.appendChild(buildImageThumbCell(imageUrl));
          td.appendChild(cellDiv);
          tr.appendChild(td);
          continue;
        }

        td.textContent = txt;
        tr.appendChild(td);
      }

      tableBody.appendChild(tr);
    });

    if (lazyObserver) lazyObserver.disconnect();
    lazyObserver = new IntersectionObserver((entries)=>{
      entries.forEach(entry=>{
        if (entry.isIntersecting){
          const img = entry.target;
          if (img.dataset && img.dataset.src){
            img.src = img.dataset.src;
            delete img.dataset.src;
          }
          lazyObserver.unobserve(img);
        }
      });
    }, { root: tableScroll, rootMargin: "100px", threshold: 0.1 });

    $$(".thumb-wrapper img[loading='lazy']", tableBody).forEach(img=>{
      lazyObserver.observe(img);
    });

    applyImageToggle();
  }

  function applyImageToggle(){
    const showImages = imageToggle.checked;
    if (showImages) {
      document.body.classList.remove("image-hidden");
    } else {
      document.body.classList.add("image-hidden");
    }
  }

  imageToggle.addEventListener("change", ()=>{
    applyImageToggle();
    const showImages = imageToggle.checked;
    setHudConsole(showImages ? "Image thumbnails enabled." : "Image thumbnails hidden (text-only mode).");
  });

  function buildQuery(gid){
    const cols = Object.values(COL_LETTERS).join(",");
    const tq = encodeURIComponent(`select ${cols}`);
    return `${SHEET_BASE}&gid=${gid}&tq=${tq}`;
  }

  async function fetchSheetData(gid){
    const url = buildQuery(gid);
    setHudConsole("Requesting updated sheet data from Google‚Ä¶");
    const res = await fetch(url, {cache:"no-store"});
    const text = await res.text();
    const jsonStr = text.replace(/^.*?\(/, "").replace(/\);\s*$/, "");
    const json = JSON.parse(jsonStr);
    return json;
  }

  function normalizeRows(json){
    const rows = json.table.rows || [];
    const data = [];
    rows.forEach(r=>{
      const cells = r.c || [];
      const row = cells.map(c=> c ? (c.f || c.v || "") : "");
      data.push(row);
    });
    return data;
  }

  async function loadDataForGid(gid){
    currentGid = gid;
    loadingMask.style.display = "flex";
    setHudConsole("Syncing with Google Sheets‚Ä¶");
    setHudThreatText("Satellite uplink‚Ä¶ parsing region feed.");

    try {
      const json = await fetchSheetData(gid);
      const rawRows = normalizeRows(json);
      tableData = rawRows.slice(1);
      updateStats(tableData);
      renderTable();
      loadingMask.style.display = "none";
      setHudConsole(`Loaded ${tableData.length} profiles for current region.`);
      setHudThreatText("HUD synchronized. Threat overlays active.");
      lastFetchSignature = JSON.stringify(tableData.map(r=>[r[NAME_COL_IDX], r[J_COL_IDX], r[K_COL_IDX]]));
    } catch(e){
      console.error(e);
      loadingMask.style.display = "none";
      setHudConsole("Error loading data from Sheets. Please try again later.");
      setHudThreatText("Satellite uplink error. Retrying in background‚Ä¶");
    }
  }

  $$(".button-row .btn").forEach(btn=>{
    btn.addEventListener("click", ()=>{
      const gid = btn.getAttribute("data-gid");
      if (!gid || gid === currentGid) return;
      $$(".button-row .btn").forEach(b=>b.classList.remove("active"));
      btn.classList.add("active");
      loadDataForGid(gid);
    });
  });

  $("#dataTable thead").addEventListener("click", (e)=>{
    const th = e.target.closest("th[data-sort]");
    if (!th) return;
    const key = th.getAttribute("data-sort");
    if (currentSort.key === key){
      currentSort.dir *= -1;
    } else {
      currentSort.key = key;
      currentSort.dir = 1;
    }
    renderTable();
  });

  resetSortBtn.addEventListener("click", ()=>{
    currentSort = { key: null, dir: 1 };
    searchInput.value = "";
    renderTable();
    setHudConsole("Sorting and search reset; showing raw sheet ordering.");
  });

  downloadCsvBtn.addEventListener("click", ()=>{
    const headerRow = Object.keys(COL_LETTERS);
    const rows = tableData.map(row=> headerRow.map(colKey=>{
      const idx = COL_IDX[colKey];
      return (row[idx] || "").toString().replace(/"/g,'""');
    }));
    const csvLines = [];
    csvLines.push(headerRow.join(","));
    rows.forEach(r=> csvLines.push(r.map(v=> `"${v}"`).join(",")));
    const blob = new Blob([csvLines.join("\n")], {type:"text/csv;charset=utf-8;"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "ftt-list-export.csv";
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    setHudConsole("CSV export generated locally (based on current view).");
  });

  searchInput.addEventListener("input", ()=>{
    renderTable();
  });

  function startPolling(){
    if (pollingInterval) clearInterval(pollingInterval);
    pollingInterval = setInterval(async ()=>{
      try{
        const json = await fetchSheetData(currentGid);
        const rawRows = normalizeRows(json);
        const data = rawRows.slice(1);
        const signature = JSON.stringify(data.map(r=>[r[NAME_COL_IDX], r[J_COL_IDX], r[K_COL_IDX]]));
        if (signature !== lastFetchSignature){
          setHudConsole("Live update detected in sheet; refreshing view.");
          tableData = data;
          updateStats(tableData);
          renderTable();
          lastFetchSignature = signature;
        }
      }catch(e){
        console.warn("Polling error", e);
      }
    }, 60000);
  }

  document.addEventListener("visibilitychange", ()=>{
    if (document.hidden){
      if (pollingInterval) clearInterval(pollingInterval);
    } else {
      startPolling();
    }
  });

  (function bootstrap(){
    loadDataForGid(currentGid).then(()=>{
      applyImageToggle();
      startPolling();
    });
  })();
  </script>
</body>
</html>
          const links = F_COL_IDX >= 0 ? (row[F_COL_IDX] || "") : "";
          const social = G_COL_IDX >= 0 ? (row[G_COL_IDX] || "") : "";
          const scat = SCAT_COL_IDX >= 0 ? (row[SCAT_COL_IDX] || "") : "";
          const fet = FETLIFE_COL_IDX >= 0 ? (row[FETLIFE_COL_IDX] || "") : "";
          const block = document.createElement("div");
          block.className = "stack-block";

          function addLine(label, value){
            if (!value || !String(value).trim()) return;
            const line = document.createElement("div");
            line.className = "stack-line";
            const l = document.createElement("span");
            l.className = "stack-label";
            l.textContent = label;
            const v = document.createElement("span");
            v.className = "stack-value";
            const frag = linkifyWithMore(value, {alwaysShow:false, pretty:true});
            if (frag) v.appendChild(frag); else v.textContent = value;
            line.appendChild(l);
            line.appendChild(v);
            block.appendChild(line);
          }

          function firstUrlOrEmpty(text) {
            const m = text && text.match(URL_RE);
            return m ? m[1] : "";
          }

          function usernameFromUrl(url) {
            try {
              const u = new URL(url);
              const parts = (u.pathname || "").split("/").filter(Boolean);
              return parts[parts.length - 1] || "";
            } catch {
              return "";
            }
          }

          function stripComToDash(host) {
            return host.replace(/\.com$/i, " - ");
          }

          function buildSocialPill(raw) {
            if (!raw || !raw.trim()) return null;
            const kind = detectSocialKind(raw);
            const url = firstUrlOrEmpty(raw);
            let handle = "";
            let href = url || "";

            if (kind === "x") {
              if (url) {
                handle = usernameFromUrl(url);
              }
              if (!handle && /^@/.test(raw.trim())) {
                handle = raw.trim().replace(/^@+/, "").split(/\s+/)[0];
              }
              if (!href && handle) {
                href = "https://x.com/" + handle;
              }
              if (!handle) return null;
              const a = document.createElement("a");
              a.href = href || "#";
              a.target = "_blank";
              a.rel = "noopener";
              a.textContent = "X: " + handle;
              a.className = "btn small pill-x";
              return a;
            }

            // Bluesky or generic social with @handle
            if (/@/.test(raw)) {
              const match = raw.match(/@[A-Za-z0-9_.-]+/);
              if (match) {
                handle = match[0];
              }
            }
            if (!handle) {
              const u2 = url;
              if (u2) {
                const name = usernameFromUrl(u2);
                if (name) handle = "@" + name;
              }
            }
            if (!handle) return null;

            const a = document.createElement("a");
            a.href = href || "#";
            a.target = "_blank";
            a.rel = "noopener";
            a.textContent = "Social: " + handle;
            a.className = "btn small pill-social";
            return a;
          }

          function buildLinkHubPill(raw) {
            if (!raw || !raw.trim()) return null;
            const url = firstUrlOrEmpty(raw);
            if (!url) return null;
            try {
              const u = new URL(url);
              const host = (u.hostname || "").replace(/^www\./i, "");
              const parts = (u.pathname || "").split("/").filter(Boolean);
              const user = parts[0] || "";
              let label;

              if (/^linktr\.ee$/i.test(host)) {
                label = "Link Tree: " + (user || host);
              } else if (/^allmylinks\.com$/i.test(host)) {
                label = "All my links: " + (user || host);
              } else if (/^beacons\.ai$/i.test(host)) {
                label = "Links: Beacons- " + (user || host);
              } else {
                let base = stripComToDash(host);
                if (user) {
                  label = base + " " + user;
                } else {
                  label = base;
                }
              }

              const a = document.createElement("a");
              a.href = url;
              a.target = "_blank";
              a.rel = "noopener";
              a.textContent = label;
              a.className = "btn small pill-link";
              return a;
            } catch {
              return null;
            }
          }

          function buildScatPill(raw) {
            if (!raw || !raw.trim()) return null;
            const url = firstUrlOrEmpty(raw);
            if (!url) return null;
            try {
              const u = new URL(url);
              const hostRaw = (u.hostname || "").replace(/^www\./i, "");
              const host = hostRaw.toLowerCase();
              const parts = (u.pathname || "").split("/").filter(Boolean);
              const user = parts[0] || "";
              let label;

              if (host.includes("scatbook")) {
                label = "Scatbook: " + (user || "profile");
              } else if (host.includes("darkfans")) {
                label = "Darkfans: " + (user || "profile");
              } else {
                let base = stripComToDash(hostRaw);
                const pretty = prettyUrlText(url).replace(/\.com\b/i, " - ");
                label = "Scat link: " + pretty;
              }

              const a = document.createElement("a");
              a.href = url;
              a.target = "_blank";
              a.rel = "noopener";
              a.textContent = label;
              a.className = "btn small pill-scat";

              return a;
            } catch {
              return null;
            }
          }

          if (website.trim()) addLine("Website:", website);

          if (links.trim()) {
            const line = document.createElement("div");
            line.className = "stack-line";
            const v = document.createElement("span");
            v.className = "stack-value";
            const pill = buildLinkHubPill(links);
            if (pill) {
              v.appendChild(pill);
            } else {
              const frag = linkifyWithMore(links, {alwaysShow:false, pretty:true});
              if (frag) v.appendChild(frag); else v.textContent = links;
            }
            line.appendChild(v);
            block.appendChild(line);
          }

          if (social.trim()) {
            const line = document.createElement("div");
            line.className = "stack-line";
            const v = document.createElement("span");
            v.className = "stack-value";
            const pill = buildSocialPill(social);
            if (pill) {
              v.appendChild(pill);
            } else {
              const frag = linkifyWithMore(social, {alwaysShow:false, pretty:true});
              if (frag) v.appendChild(frag); else v.textContent = social;
            }
            line.appendChild(v);
            block.appendChild(line);
          }

          if (scat.trim()) {
            const line = document.createElement("div");
            line.className = "stack-line";
            const v = document.createElement("span");
            v.className = "stack-value";
            const pill = buildScatPill(scat);
            if (pill) {
              v.appendChild(pill);
            } else {
              const frag = linkifyWithMore(scat, {alwaysShow:false, pretty:true});
              if (frag) v.appendChild(frag); else v.textContent = scat;
            }
            line.appendChild(v);
            block.appendChild(line);
          }

          if (fet.trim()) addLine("Fetlife:", fet);

          td.appendChild(block);
          tr.appendChild(td);
          continue;
        }
/* Combined Contact info */
        if (c === EMAIL_COL_IDX && rIdx > 1) {
          const emailRaw = row[EMAIL_COL_IDX] || "";
          const redditRaw = P_COL_IDX >= 0 ? (row[P_COL_IDX] || "") : "";
          const phoneRaw = Q_COL_IDX >= 0 ? (row[Q_COL_IDX] || "") : "";
          const whatsappRaw = WHATSAPP_COL_IDX >= 0 ? (row[WHATSAPP_COL_IDX] || "") : "";
          const block = document.createElement("div");
          block.className = "stack-block";

          function addMulti(labelBase, raw, builder){
            if (!raw) return;
            const parts = String(raw).split(/[;,]/);
            let idxInner = 0;
            for (const part of parts) {
              const val = part.trim();
              if (!val) continue;
              const node = builder(val);
              if (!node) continue;
              const lineInner = document.createElement("div");
              lineInner.className = "stack-line";
              const lInner = document.createElement("span");
              lInner.className = "stack-label";
              lInner.textContent = idxInner === 0 ? labelBase + ":" : labelBase + " alt:";
              const vInner = document.createElement("span");
              vInner.className = "stack-value";
              vInner.appendChild(node);
              lineInner.appendChild(lInner);
              lineInner.appendChild(vInner);
              block.appendChild(lineInner);
              idxInner++;
            }
          }

          addMulti("Phone", phoneRaw, (val)=>buildTelAnchor(val));
          addMulti("WhatsApp", whatsappRaw, (val)=>buildWhatsappAnchor(val));
          addMulti("Email", emailRaw, (val)=>{
            if (!/@/.test(val)) return null;
            const a = document.createElement("a");
            a.href = `mailto:${val.trim()}`;
            a.textContent = val.trim();
            a.className = "cell-link";
            return a;
          });

          if (redditRaw && String(redditRaw).trim()) {
            const parts = String(redditRaw).split(/[;,]/);
            for (const part of parts) {
              const val = part.trim();
              if (!val) continue;
              const user = parseRedditUsername(val);
              if (!user) continue;
              const lineR = document.createElement("div");
              lineR.className = "stack-line";
              const vR = document.createElement("span");
              vR.className = "stack-value";
              const aR = document.createElement("a");
              aR.href = `https://www.reddit.com/user/${encodeURIComponent(user)}`;
              aR.target = "_blank";
              aR.rel = "noopener";
              aR.textContent = `Reddit: u/${user}`;
              aR.className = "btn small pill-reddit-contact";
              vR.appendChild(aR);
              lineR.appendChild(vR);
              block.appendChild(lineR);
            }
          }

          td.appendChild(block);
          tr.appendChild(td);
          continue;
        }

        if (c === L_COL_IDX && rIdx > 1) {
          const note = row[L_COL_IDX] || "";
          const block = document.createElement("div");
          block.className = "stack-block";
          if (note && String(note).trim()) {
            const lineNote = document.createElement("div");
            lineNote.textContent = note;
            appendScamIcon(lineNote, note);
            block.appendChild(lineNote);
          } else {
            const lineNote = document.createElement("div");
            lineNote.textContent = "No extra notes in sheet yet.";
            block.appendChild(lineNote);
          }
          td.appendChild(block);
          tr.appendChild(td);
          continue;
        }

        if (c === N_COL_IDX && rIdx > 1) {
          const imageUrl = row[N_COL_IDX] || "";
          const cellDiv = document.createElement("div");
          cellDiv.className = "images-cell";
          cellDiv.appendChild(buildImageThumbCell(imageUrl));
          td.appendChild(cellDiv);
          tr.appendChild(td);
          continue;
        }

        td.textContent = txt;
        tr.appendChild(td);
      }

      tableBody.appendChild(tr);
    });

    if (lazyObserver) lazyObserver.disconnect();
    lazyObserver = new IntersectionObserver((entries)=>{
      entries.forEach(entry=>{
        if (entry.isIntersecting){
          const img = entry.target;
          if (img.dataset && img.dataset.src){
            img.src = img.dataset.src;
            delete img.dataset.src;
          }
          lazyObserver.unobserve(img);
        }
      });
    }, { root: tableScroll, rootMargin: "100px", threshold: 0.1 });

    $$(".thumb-wrapper img[loading='lazy']", tableBody).forEach(img=>{
      lazyObserver.observe(img);
    });

    applyImageToggle();
  }

  function applyImageToggle(){
    const showImages = imageToggle.checked;
    if (showImages) {
      document.body.classList.remove("image-hidden");
    } else {
      document.body.classList.add("image-hidden");
    }
  }

  imageToggle.addEventListener("change", ()=>{
    applyImageToggle();
    const showImages = imageToggle.checked;
    setHudConsole(showImages ? "Image thumbnails enabled." : "Image thumbnails hidden (text-only mode).");
  });

  function buildQuery(gid){
    const cols = Object.values(COL_LETTERS).join(",");
    const tq = encodeURIComponent(`select ${cols}`);
    return `${SHEET_BASE}&gid=${gid}&tq=${tq}`;
  }

  async function fetchSheetData(gid){
    const url = buildQuery(gid);
    setHudConsole("Requesting updated sheet data from Google‚Ä¶");
    const res = await fetch(url, {cache:"no-store"});
    const text = await res.text();
    const jsonStr = text.replace(/^.*?\(/, "").replace(/\);\s*$/, "");
    const json = JSON.parse(jsonStr);
    return json;
  }

  function normalizeRows(json){
    const rows = json.table.rows || [];
    const data = [];
    rows.forEach(r=>{
      const cells = r.c || [];
      const row = cells.map(c=> c ? (c.f || c.v || "") : "");
      data.push(row);
    });
    return data;
  }

  async function loadDataForGid(gid){
    currentGid = gid;
    loadingMask.style.display = "flex";
    setHudConsole("Syncing with Google Sheets‚Ä¶");
    setHudThreatText("Satellite uplink‚Ä¶ parsing region feed.");

    try {
      const json = await fetchSheetData(gid);
      const rawRows = normalizeRows(json);
      tableData = rawRows.slice(1);
      updateStats(tableData);
      renderTable();
      loadingMask.style.display = "none";
      setHudConsole(`Loaded ${tableData.length} profiles for current region.`);
      setHudThreatText("HUD synchronized. Threat overlays active.");
      lastFetchSignature = JSON.stringify(tableData.map(r=>[r[NAME_COL_IDX], r[J_COL_IDX], r[K_COL_IDX]]));
    } catch(e){
      console.error(e);
      loadingMask.style.display = "none";
      setHudConsole("Error loading data from Sheets. Please try again later.");
      setHudThreatText("Satellite uplink error. Retrying in background‚Ä¶");
    }
  }

  $$(".button-row .btn").forEach(btn=>{
    btn.addEventListener("click", ()=>{
      const gid = btn.getAttribute("data-gid");
      if (!gid || gid === currentGid) return;
      $$(".button-row .btn").forEach(b=>b.classList.remove("active"));
      btn.classList.add("active");
      loadDataForGid(gid);
    });
  });

  $("#dataTable thead").addEventListener("click", (e)=>{
    const th = e.target.closest("th[data-sort]");
    if (!th) return;
    const key = th.getAttribute("data-sort");
    if (currentSort.key === key){
      currentSort.dir *= -1;
    } else {
      currentSort.key = key;
      currentSort.dir = 1;
    }
    renderTable();
  });

  resetSortBtn.addEventListener("click", ()=>{
    currentSort = { key: null, dir: 1 };
    searchInput.value = "";
    renderTable();
    setHudConsole("Sorting and search reset; showing raw sheet ordering.");
  });

  downloadCsvBtn.addEventListener("click", ()=>{
    const headerRow = Object.keys(COL_LETTERS);
    const rows = tableData.map(row=> headerRow.map(colKey=>{
      const idx = COL_IDX[colKey];
      return (row[idx] || "").toString().replace(/"/g,'""');
    }));
    const csvLines = [];
    csvLines.push(headerRow.join(","));
    rows.forEach(r=> csvLines.push(r.map(v=> `"${v}"`).join(",")));
    const blob = new Blob([csvLines.join("\n")], {type:"text/csv;charset=utf-8;"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "ftt-list-export.csv";
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    setHudConsole("CSV export generated locally (based on current view).");
  });

  searchInput.addEventListener("input", ()=>{
    renderTable();
  });

  function startPolling(){
    if (pollingInterval) clearInterval(pollingInterval);
    pollingInterval = setInterval(async ()=>{
      try{
        const json = await fetchSheetData(currentGid);
        const rawRows = normalizeRows(json);
        const data = rawRows.slice(1);
        const signature = JSON.stringify(data.map(r=>[r[NAME_COL_IDX], r[J_COL_IDX], r[K_COL_IDX]]));
        if (signature !== lastFetchSignature){
          setHudConsole("Live update detected in sheet; refreshing view.");
          tableData = data;
          updateStats(tableData);
          renderTable();
          lastFetchSignature = signature;
        }
      }catch(e){
        console.warn("Polling error", e);
      }
    }, 60000);
  }

  document.addEventListener("visibilitychange", ()=>{
    if (document.hidden){
      if (pollingInterval) clearInterval(pollingInterval);
    } else {
      startPolling();
    }
  });

  (function bootstrap(){
    loadDataForGid(currentGid).then(()=>{
      applyImageToggle();
      startPolling();
    });
  })();
  </script>
</body>
</html>
